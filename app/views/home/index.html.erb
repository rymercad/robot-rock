<h1>Welcome to the Workout Playlist App</h1>

<% if user_signed_in? %>
  <p>Hello, <%= current_user.email %>!</p>
  <p><%= link_to 'Logout', users_sign_out_path, method: :delete %></p>

  <h2>Today's Workouts</h2>
  <% if @todays_playlists.any? %>
    <% @todays_playlists.each do |playlist| %>
      <h3><%= playlist.workout_name %></h3>
      <%= simple_format(playlist.description) %>
      <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/<%= playlist.spotify_playlist_id %>" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
    <% end %>
    <% if current_user.admin? %>
      <%= button_to 'Regenerate Playlists', regenerate_playlists_path, method: :post, data: { turbo: false } %>
    <% end %>
  <% else %>
    <p>No workouts scheduled for today.</p>
  <% end %>

  <h2>Your Preferences</h2>
  <% if @preference %>
    <h3>Musical Tastes</h3>
    <%= simple_format(@preference.musical_tastes) %>

    <h3>Calendar URL</h3>
    <%= simple_format(@preference.calendar_url) %>

    <h3>Time Zone</h3>
    <%= simple_format(@preference.timezone) %>

    <p><%= link_to 'Edit Preferences', edit_preference_path %></p>
  <% else %>
    <p>You have not set your preferences yet.</p>
    <p><%= link_to 'Set Preferences', edit_preference_path %></p>
  <% end %>

  <% if current_user.admin? %>
    <p><%= link_to 'Sidekiq', "/sidekiq", target: "_blank" %></p>
  <% end %>

<% else %>
  <%= button_to 'Sign in with Spotify', user_spotify_omniauth_authorize_path, method: :post, data: { turbo: false } %>
<% end %>
